import*as THREE from"three";import{ConvexGeometry}from"three/examples/jsm/geometries/ConvexGeometry.js";import{commons}from"./lib/Common.js";export class MyMovable{constructor(e,o=0){this.myPhysicsWorld=e,this.yPos=o,this.convexRigidBody=void 0}create(e=!0,o=1,t={x:0,y:0+this.yPos,z:0},s=0,i=5){let r=this.generateConvexGeometryByGiven(o,i),n=new ConvexGeometry(r),y=new THREE.Mesh(n,new THREE.MeshPhongMaterial({color:461565}));y.userData.tag="movalbe",y.scale.set(1,1,1),t.y=t.y+y.scale.y*i/2,y.position.set(t.x,t.y,t.z),y.castShadow=!0,y.collisionResponse=e=>{e.material.color.setHex(16777215*Math.random())};let m=commons.createConvexHullShape(r);this.convexRigidBody=commons.createAmmoRigidBody(m,y,.7,.8,t,s),this.convexRigidBody.setCollisionFlags(2|this.convexRigidBody.getCollisionFlags()),this.convexRigidBody.setActivationState(4),this.myPhysicsWorld.addPhysicsObject(this.convexRigidBody,y,e,this.myPhysicsWorld.COLLISION_GROUP_MOVEABLE,this.myPhysicsWorld.COLLISION_GROUP_PLANE|this.myPhysicsWorld.COLLISION_GROUP_SPHERE|this.myPhysicsWorld.COLLISION_GROUP_COMPOUND|this.myPhysicsWorld.COLLISION_GROUP_CONVEX|this.myPhysicsWorld.COLLISION_GROUP_TRIANGLE|this.myPhysicsWorld.COLLISION_GROUP_HINGE_SPHERE|this.myPhysicsWorld.COLLISION_GROUP_BOX)}generateConvexGeometryByGiven(e,o=1){let t,s=[];switch(e){case 0:t=new THREE.DodecahedronGeometry(o).attributes.position;break;case 1:t=new THREE.CylinderGeometry(o,o,o,8,1,!1).attributes.position;break;case 2:t=new THREE.SphereGeometry(o).attributes.position;break;default:t=new THREE.BoxGeometry(o,o,o).attributes.position}for(let e=0;e<t.count;e++){let o=new THREE.Vector3;o.fromBufferAttribute(t,e),s.push(o)}return s}move(e){let o=new Ammo.btTransform,t=this.convexRigidBody.getMotionState();t.getWorldTransform(o);let s=o.getOrigin();o.setOrigin(new Ammo.btVector3(s.x()+e.x,s.y()+e.y,s.z()+e.z)),t.setWorldTransform(o)}}