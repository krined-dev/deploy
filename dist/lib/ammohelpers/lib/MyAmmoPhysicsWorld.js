export class MyAmmoPhysicsWorld{constructor(){this.ammoPhysicsWorld=void 0,this.scene=void 0,this.catchCollisionEvents=!1,this.rigidBodies=[],this.COLLISION_GROUP_PLANE=1,this.COLLISION_GROUP_SPHERE=2,this.COLLISION_GROUP_CONVEX=4,this.COLLISION_GROUP_COMPOUND=8,this.COLLISION_GROUP_MOVEABLE=16,this.COLLISION_GROUP_TRIANGLE=32,this.COLLISION_GROUP_HINGE_SPHERE=64,this.COLLISION_GROUP_BOX=128,this.tmpTrans=void 0}init(t,s=!1){if(!t)return void console.log("Mangler three-sceneobjekt.");this.scene=t,this.catchCollisionEvents=s,this.tmpTrans=new Ammo.btTransform;let i=new Ammo.btDefaultCollisionConfiguration,e=new Ammo.btCollisionDispatcher(i),o=new Ammo.btDbvtBroadphase,n=new Ammo.btSequentialImpulseConstraintSolver;this.ammoPhysicsWorld=new Ammo.btDiscreteDynamicsWorld(e,o,n,i),this.ammoPhysicsWorld.setGravity(new Ammo.btVector3(0,-9.81,0))}addPhysicsObject(t,s,i,e,o){i?this.ammoPhysicsWorld.addRigidBody(t,e,o):this.ammoPhysicsWorld.addRigidBody(t),s.userData.physicsBody=t,this.scene.add(s),this.rigidBodies.push(s),t.threeMesh=s}updatePhysics(t){if(this.tmpTrans){this.ammoPhysicsWorld.stepSimulation(t,10);for(let t=0;t<this.rigidBodies.length;t++){let s=this.rigidBodies[t],i=s.userData.physicsBody.getMotionState();if(i){i.getWorldTransform(this.tmpTrans);let t=this.tmpTrans.getOrigin(),e=this.tmpTrans.getRotation();s.position.set(t.x(),t.y(),t.z()),s.quaternion.set(e.x(),e.y(),e.z(),e.w())}}this.catchCollisionEvents&&this.checkCollisions(t)}}checkCollisions(t){let s=this.ammoPhysicsWorld.getDispatcher().getNumManifolds();for(let t=0;t<s;t++){let s=this.ammoPhysicsWorld.getDispatcher().getManifoldByIndexInternal(t),i=s.getNumContacts();if(i>0){let t=Ammo.castObject(s.getBody0(),Ammo.btRigidBody),e=Ammo.castObject(s.getBody1(),Ammo.btRigidBody),o=t.threeMesh,n=e.threeMesh;if(o&&n)for(let t=0;t<i;t++)s.getContactPoint(t).getDistance()<=0&&("sphere"!==o.userData.tag&&"movalbe"!==o.userData.tag||"sphere"!==n.userData.tag&&"movalbe"!==n.userData.tag||("function"==typeof o.collisionResponse&&o.collisionResponse(o),"function"==typeof n.collisionResponse&&n.collisionResponse(n)))}}}}